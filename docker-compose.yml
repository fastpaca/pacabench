version: "3.9"

services:
  qdrant:
    image: qdrant/qdrant:latest
    restart: unless-stopped
    environment:
      QDRANT__LOG_LEVEL: "ERROR"   # Qdrantâ€™s config key
      RUST_LOG: "error"            # extra belt-and-suspenders
    ports:
      - "6333:6333"
    volumes:
      - ./qdrant_storage:/qdrant/storage

  neo4j:
    image: neo4j:5.21
    restart: unless-stopped
    environment:
      NEO4J_AUTH: neo4j/password
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - ./neo4j_data:/data

  agentbench:
    build: .
    depends_on:
      - qdrant
      - neo4j
    environment:
      OPENAI_API_KEY: "${OPENAI_API_KEY}"
      MEM0_QDRANT_HOST: "qdrant"
      NEO4J_URI: "bolt://neo4j:7687"
      NEO4J_USER: "neo4j"
      NEO4J_PASSWORD: "password"
      LOG_LEVEL: "ERROR"
    working_dir: /app
    volumes:
      - ./runs:/app/runs
    # Relax limits inside the container to avoid thread/FD caps
    ulimits:
      nproc: 65535
      nofile: 1048576
    command: >
      resume membench-qa-mem0-20251118-222118
